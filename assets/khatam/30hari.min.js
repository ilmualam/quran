/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * JADUAL KHATAM AL-QURAN 30 HARI - INTERACTIVE TRACKER TOOL
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Copyright Â© 2025 IlmuAlam.com
 * All Rights Reserved
 * 
 * Features:
 * - 3 Pre-set Templates (Ramadan, Year-Round, Custom)
 * - Auto-save Progress (localStorage)
 * - Real-time Stats Dashboard
 * - Streak Counter & Achievements
 * - Dark Mode Support
 * - Mobile-Responsive
 * - Share Progress Functionality
 * - Domain Protection
 * 
 * Version: 1.0.0
 * Last Updated: December 2025
 */

(function() {
    'use strict';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DOMAIN PROTECTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const ALLOWED_DOMAINS = [
        'ilmualam.com',
        'www.ilmualam.com',
        'ilmualam.blogspot.com',
        'blogger.com',
        'blogspot.com',
        'localhost',
        '127.0.0.1'
    ];

    const currentDomain = window.location.hostname;
    const isAllowed = ALLOWED_DOMAINS.some(domain => 
        currentDomain === domain || currentDomain.endsWith('.' + domain)
    );

    if (!isAllowed) {
        console.error('âš ï¸ Tool ini hanya boleh digunakan di ilmualam.com');
        document.getElementById('khatamToolContainer').innerHTML = `
            <div style="background: #f8d7da; color: #721c24; padding: 2rem; border-radius: 12px; text-align: center;">
                <h3>âš ï¸ Akses Ditolak</h3>
                <p>Tool ini hanya boleh digunakan di <strong>ilmualam.com</strong></p>
                <p><a href="https://ilmualam.com" style="color: #721c24;">Lawati IlmuAlam.com</a></p>
            </div>
        `;
        return;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DATA: 30 JUZUK AL-QURAN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const juzukData = [
        { id: 1, juzuk: 1, startSurah: "Al-Fatihah", startAyat: 1, endSurah: "Al-Baqarah", endAyat: 141, pages: "1-21" },
        { id: 2, juzuk: 2, startSurah: "Al-Baqarah", startAyat: 142, endSurah: "Al-Baqarah", endAyat: 252, pages: "22-41" },
        { id: 3, juzuk: 3, startSurah: "Al-Baqarah", startAyat: 253, endSurah: "Ali 'Imran", endAyat: 92, pages: "42-61" },
        { id: 4, juzuk: 4, startSurah: "Ali 'Imran", startAyat: 93, endSurah: "An-Nisa", endAyat: 23, pages: "62-81" },
        { id: 5, juzuk: 5, startSurah: "An-Nisa", startAyat: 24, endSurah: "An-Nisa", endAyat: 147, pages: "82-101" },
        { id: 6, juzuk: 6, startSurah: "An-Nisa", startAyat: 148, endSurah: "Al-Ma'idah", endAyat: 81, pages: "102-121" },
        { id: 7, juzuk: 7, startSurah: "Al-Ma'idah", startAyat: 82, endSurah: "Al-An'am", endAyat: 110, pages: "122-141" },
        { id: 8, juzuk: 8, startSurah: "Al-An'am", startAyat: 111, endSurah: "Al-A'raf", endAyat: 87, pages: "142-161" },
        { id: 9, juzuk: 9, startSurah: "Al-A'raf", startAyat: 88, endSurah: "Al-Anfal", endAyat: 40, pages: "162-181" },
        { id: 10, juzuk: 10, startSurah: "Al-Anfal", startAyat: 41, endSurah: "At-Tawbah", endAyat: 92, pages: "182-201" },
        { id: 11, juzuk: 11, startSurah: "At-Tawbah", startAyat: 93, endSurah: "Hud", endAyat: 5, pages: "202-221" },
        { id: 12, juzuk: 12, startSurah: "Hud", startAyat: 6, endSurah: "Yusuf", endAyat: 52, pages: "222-241" },
        { id: 13, juzuk: 13, startSurah: "Yusuf", startAyat: 53, endSurah: "Ibrahim", endAyat: 52, pages: "242-261" },
        { id: 14, juzuk: 14, startSurah: "Al-Hijr", startAyat: 1, endSurah: "An-Nahl", endAyat: 128, pages: "262-281" },
        { id: 15, juzuk: 15, startSurah: "Al-Isra", startAyat: 1, endSurah: "Al-Kahf", endAyat: 74, pages: "282-301" },
        { id: 16, juzuk: 16, startSurah: "Al-Kahf", startAyat: 75, endSurah: "Ta-Ha", endAyat: 135, pages: "302-321" },
        { id: 17, juzuk: 17, startSurah: "Al-Anbiya", startAyat: 1, endSurah: "Al-Hajj", endAyat: 78, pages: "322-341" },
        { id: 18, juzuk: 18, startSurah: "Al-Mu'minun", startAyat: 1, endSurah: "Al-Furqan", endAyat: 20, pages: "342-361" },
        { id: 19, juzuk: 19, startSurah: "Al-Furqan", startAyat: 21, endSurah: "An-Naml", endAyat: 59, pages: "362-381" },
        { id: 20, juzuk: 20, startSurah: "An-Naml", startAyat: 60, endSurah: "Al-'Ankabut", endAyat: 45, pages: "382-401" },
        { id: 21, juzuk: 21, startSurah: "Al-'Ankabut", startAyat: 46, endSurah: "Al-Ahzab", endAyat: 30, pages: "402-421" },
        { id: 22, juzuk: 22, startSurah: "Al-Ahzab", startAyat: 31, endSurah: "Ya-Sin", endAyat: 27, pages: "422-441" },
        { id: 23, juzuk: 23, startSurah: "Ya-Sin", startAyat: 28, endSurah: "Az-Zumar", endAyat: 31, pages: "442-461" },
        { id: 24, juzuk: 24, startSurah: "Az-Zumar", startAyat: 32, endSurah: "Fussilat", endAyat: 46, pages: "462-481" },
        { id: 25, juzuk: 25, startSurah: "Fussilat", startAyat: 47, endSurah: "Al-Jathiyah", endAyat: 37, pages: "482-501" },
        { id: 26, juzuk: 26, startSurah: "Al-Ahqaf", startAyat: 1, endSurah: "Adh-Dhariyat", endAyat: 30, pages: "502-521" },
        { id: 27, juzuk: 27, startSurah: "Adh-Dhariyat", startAyat: 31, endSurah: "Al-Hadid", endAyat: 29, pages: "522-541" },
        { id: 28, juzuk: 28, startSurah: "Al-Mujadila", startAyat: 1, endSurah: "At-Tahrim", endAyat: 12, pages: "542-561" },
        { id: 29, juzuk: 29, startSurah: "Al-Mulk", startAyat: 1, endSurah: "Al-Mursalat", endAyat: 50, pages: "562-581" },
        { id: 30, juzuk: 30, startSurah: "An-Naba", startAyat: 1, endSurah: "An-Nas", endAyat: 6, pages: "582-604" }
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE MANAGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let state = {
        selectedTemplate: 'ramadan', // 'ramadan', 'yearround', 'custom'
        customDays: 30,
        completedJuzuk: [],
        streak: 0,
        lastReadDate: null,
        startDate: null,
        darkMode: false,
        showInfo: {}
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOCALSTORAGE FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function saveState() {
        try {
            localStorage.setItem('khatamQuran30Days', JSON.stringify(state));
        } catch (e) {
            console.error('Failed to save state:', e);
        }
    }

    function loadState() {
        try {
            const saved = localStorage.getItem('khatamQuran30Days');
            if (saved) {
                const loaded = JSON.parse(saved);
                state = { ...state, ...loaded };
                
                // Update streak if needed
                updateStreak();
            }
        } catch (e) {
            console.error('Failed to load state:', e);
        }
    }

    function updateStreak() {
        if (!state.lastReadDate) return;
        
        const today = new Date().toDateString();
        const lastRead = new Date(state.lastReadDate).toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        
        if (lastRead === today) {
            // Already read today, streak stays
            return;
        } else if (lastRead === yesterday) {
            // Continue streak
            return;
        } else {
            // Streak broken
            state.streak = 0;
        }
    }

    function resetProgress() {
        if (confirm('âš ï¸ Adakah anda pasti nak reset semua progress? Tindakan ini tidak boleh dibatalkan.')) {
            state = {
                selectedTemplate: 'ramadan',
                customDays: 30,
                completedJuzuk: [],
                streak: 0,
                lastReadDate: null,
                startDate: null,
                darkMode: state.darkMode, // Keep dark mode setting
                showInfo: {}
            };
            saveState();
            render();
            alert('âœ… Progress telah direset. Mulakan journey baru anda!');
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CORE FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function toggleJuzuk(juzukId) {
        const index = state.completedJuzuk.indexOf(juzukId);
        
        if (index > -1) {
            // Uncheck
            state.completedJuzuk.splice(index, 1);
        } else {
            // Check
            state.completedJuzuk.push(juzukId);
            
            // Update streak
            const today = new Date().toDateString();
            const lastRead = state.lastReadDate ? new Date(state.lastReadDate).toDateString() : null;
            
            if (lastRead !== today) {
                const yesterday = new Date(Date.now() - 86400000).toDateString();
                if (lastRead === yesterday) {
                    state.streak++;
                } else {
                    state.streak = 1;
                }
                state.lastReadDate = new Date().toISOString();
            }
            
            // Set start date if first juzuk
            if (!state.startDate) {
                state.startDate = new Date().toISOString();
            }
            
            // Check for milestones
            checkMilestones();
        }
        
        saveState();
        render();
    }

    function checkMilestones() {
        const completed = state.completedJuzuk.length;
        
        if (completed === 10 && !state.milestone10) {
            state.milestone10 = true;
            showCelebration('ğŸ‰ Alhamdulillah! 1/3 Journey Completed! 10 Juzuk Done!');
        } else if (completed === 20 && !state.milestone20) {
            state.milestone20 = true;
            showCelebration('ğŸŠ Subhanallah! 2/3 Done! 20 Juzuk! Keep Going Strong!');
        } else if (completed === 30 && !state.milestone30) {
            state.milestone30 = true;
            showCelebration('ğŸ† ALLAHU AKBAR! KHATAM COMPLETE! 30 JUZUK! May Allah Accept! ğŸ¤²');
        }
    }

    function showCelebration(message) {
        const celebration = document.createElement('div');
        celebration.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #249749 0%, #0c3808 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 10000;
            text-align: center;
            max-width: 500px;
            animation: celebrationPop 0.5s ease-out;
        `;
        
        celebration.innerHTML = `
            <h2 style="margin: 0 0 1rem 0; font-size: 2rem;">${message}</h2>
            <button onclick="this.parentElement.remove()" style="background: white; color: #249749; border: none; padding: 0.75rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
                Alhamdulillah âœ¨
            </button>
        `;
        
        document.body.appendChild(celebration);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (celebration.parentElement) {
                celebration.remove();
            }
        }, 5000);
    }

    function selectTemplate(template) {
        state.selectedTemplate = template;
        if (template === 'custom') {
            const days = prompt('Berapa hari anda nak khatam? (Enter nombor 1-365)', '30');
            if (days && !isNaN(days) && days > 0 && days <= 365) {
                state.customDays = parseInt(days);
            } else {
                alert('âš ï¸ Sila masukkan nombor yang sah antara 1-365');
                state.selectedTemplate = 'ramadan';
            }
        }
        saveState();
        render();
    }

    function toggleInfo(juzukId) {
        state.showInfo[juzukId] = !state.showInfo[juzukId];
        render();
    }

    function shareProgress() {
        const completed = state.completedJuzuk.length;
        const percentage = ((completed / 30) * 100).toFixed(0);
        
        const text = `ğŸ•Œ Alhamdulillah! Saya telah complete ${completed}/30 juzuk Al-Quran (${percentage}%)!\n\nğŸ¯ Track progress khatam anda di: https://ilmualam.com/jadual-khatam-alquran-30-hari\n\n#KhatamQuran #IlmuAlam`;
        
        if (navigator.share) {
            navigator.share({
                title: 'Progress Khatam Al-Quran Saya',
                text: text
            }).catch(err => console.log('Share cancelled'));
        } else {
            // Fallback: Copy to clipboard
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… Progress copied to clipboard! Share it on your social media.');
            });
        }
    }

    function toggleDarkMode() {
        state.darkMode = !state.darkMode;
        saveState();
        render();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function render() {
        const container = document.getElementById('khatamToolContainer');
        if (!container) return;

        const completed = state.completedJuzuk.length;
        const percentage = ((completed / 30) * 100).toFixed(1);
        const remaining = 30 - completed;
        
        // Calculate estimated completion
        let estimatedDays = state.selectedTemplate === 'custom' ? state.customDays : 30;
        let daysElapsed = 0;
        if (state.startDate) {
            daysElapsed = Math.floor((Date.now() - new Date(state.startDate)) / 86400000);
        }
        const daysRemaining = Math.max(0, estimatedDays - daysElapsed);

        // Dark mode class
        const darkClass = state.darkMode ? 'dark-mode' : '';

        container.innerHTML = `
            <style>
                .khatam-tool {
                    font-family: 'Inter', Tahoma, Geneva, Verdana, sans-serif;
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 10px 10px;
                    background: #fff;
                    border-radius: 16px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                }
                .khatam-tool.dark-mode {
                    background: #1a1a1a;
                    color: #e0e0e0;
                }
                .tool-header {
                    text-align: center;
                    margin-bottom: 2rem;
                }
                .tool-header h2 {
                    color: #0c3808;
                    margin: 0 0 0.5rem 0;
                    font-size: 1.35rem;
                }
                .dark-mode .tool-header h2 {
                    color: #249749;
                }
                .tool-header p {
                    color: #666;
                    margin: 0;
                    font-size: 1.1rem;
                }
                .dark-mode .tool-header p {
                    color: #aaa;
                }
                .template-selector {
                    display: flex;
                    gap: 1rem;
                    margin-bottom: 2rem;
                    flex-wrap: wrap;
                    justify-content: center;
                }
                .template-btn {
                    flex: 1;
                    min-width: 200px;
                    padding: 1.5rem 1rem;
                    border: 2px solid #249749;
                    border-radius: 12px;
                    background: #fff;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    text-align: center;
                }
                .dark-mode .template-btn {
                    background: #2a2a2a;
                    border-color: #249749;
                    color: #e0e0e0;
                }
                .template-btn:hover {
                    background: #e8f5e9;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(36, 151, 73, 0.2);
                }
                .dark-mode .template-btn:hover {
                    background: #1e3a1e;
                }
                .template-btn.active {
                    background: linear-gradient(135deg, #249749 0%, #0c3808 100%);
                    color: #fff;
                    border-color: #0c3808;
                }
               
                .template-btn h3 {
                    margin-left:auto!important;
                    padding-left: 10px!important;
                    font-size: 1.3rem;
                    color:#0c3803;
                }
                .template-btn p {
                    margin: 0;
                    font-size: 0.9rem;
                    color:#0c3803;
                    opacity: 0.9;
                }
                .stats-dashboard {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 1.5rem;
                    margin-bottom: 2rem;
                }
                .stat-card {
                    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
                    padding: 1.5rem;
                    border-radius: 12px;
                    text-align: center;
                }
                .dark-mode .stat-card {
                    background: linear-gradient(135deg, #1e3a1e 0%, #0f2d0f 100%);
                }
                .stat-value {
                    font-size: 1.5rem;
                    font-weight: 600;
                    color: #0c3808;
                    margin: 0;
                }
                .dark-mode .stat-value {
                    color: #249749;
                }
                .stat-label {
                    font-size: 0.9rem;
                    color: #666;
                    margin: 0.5rem 0 0 0;
                    text-transform: uppercase;
                    letter-spacing: 0.05rem;
                }
                .dark-mode .stat-label {
                    color: #aaa;
                }
                .progress-bar-container {
                    margin-bottom: 2rem;
                }
                .progress-bar {
                    height: 40px;
                    background: #e0e0e0;
                    border-radius: 20px;
                    overflow: hidden;
                    position: relative;
                }
                .dark-mode .progress-bar {
                    background: #3a3a3a;
                }
                .progress-fill {
                    height: 100%;
                    background: linear-gradient(90deg, #249749 0%, #0c3808 100%);
                    border-radius: 20px;
                    transition: width 0.5s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: 600;
                    font-size: 1.1rem;
                }
                .juzuk-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                    gap: 1rem;
                    margin-bottom: 2rem;
                }
                .juzuk-card {
                    border: 2px solid #e0e0e0;
                    border-radius: 12px;
                    padding: 1.5rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    background: white;
                }
                .dark-mode .juzuk-card {
                    background: #2a2a2a;
                    border-color: #444;
                }
                .juzuk-card:hover {
                    border-color: #249749;
                    box-shadow: 0 4px 12px rgba(36, 151, 73, 0.15);
                    transform: translateY(-2px);
                }
                .juzuk-card.completed {
                    border-color: #249749;
                    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
                }
                .dark-mode .juzuk-card.completed {
                    background: linear-gradient(135deg, #1e3a1e 0%, #0f2d0f 100%);
                }
                .juzuk-header {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    margin-bottom: 0.75rem;
                }
                .checkbox {
                    width: 28px;
                    height: 28px;
                    border: 2px solid #249749;
                    border-radius: 6px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                    background: white;
                }
                .dark-mode .checkbox {
                    background: #3a3a3a;
                }
                .checkbox.checked {
                    background: #249749;
                }
                .juzuk-title {
                    font-size: 1.3rem;
                    font-weight: 600;
                    color: #0c3808;
                    margin: 0;
                }
                .dark-mode .juzuk-title {
                    color: #249749;
                }
                .juzuk-info {
                    font-size: 0.9rem;
                    color: #666;
                    margin: 0.5rem 0;
                }
                .dark-mode .juzuk-info {
                    color: #aaa;
                }
                .info-toggle {
                    font-size: 0.85rem;
                    color: #249749;
                    cursor: pointer;
                    text-decoration: underline;
                    margin-top: 0.5rem;
                    display: inline-block;
                }
                .info-details {
                    margin-top: 0.75rem;
                    padding: 0.75rem;
                    background: #f5f5f5;
                    border-radius: 8px;
                    font-size: 0.85rem;
                    color: #444;
                }
                .dark-mode .info-details {
                    background: #1a1a1a;
                    color: #ccc;
                }
                .action-buttons {
                    display: flex;
                    gap: 1rem;
                    flex-wrap: wrap;
                    justify-content: center;
                    margin-top: 2rem;
                }
                .btn {
                    padding: 1rem 2rem;
                    border: none;
                    border-radius: 12px;
                    font-size: 1rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                .btn-primary {
                    background: linear-gradient(135deg, #249749 0%, #0c3808 100%);
                    color: white;
                }
                .btn-primary:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(36, 151, 73, 0.3);
                }
                .btn-secondary {
                    background: white;
                    color: #249749;
                    border: 2px solid #249749;
                }
                .dark-mode .btn-secondary {
                    background: #2a2a2a;
                    color: #249749;
                }
                .btn-secondary:hover {
                    background: #e8f5e9;
                }
                .dark-mode .btn-secondary:hover {
                    background: #1e3a1e;
                }
                .btn-danger {
                    background: #dc3545;
                    color: white;
                }
                .btn-danger:hover {
                    background: #c82333;
                }
                @keyframes celebrationPop {
                    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                }
                @media (max-width: 768px) {
                    .template-selector {
                        flex-direction: column;
                    }
                    .template-btn {
                        min-width: 100%;
                    }
                    .juzuk-grid {
                        grid-template-columns: 1fr;
                    }
                }
            </style>

            <div class="khatam-tool ${darkClass}">
                <div class="tool-header">
                    <h2>ğŸ•Œ Jadual Khatam Al-Quran 30 Hari</h2>
                    <p>Track progress anda dengan mudah. Auto-save. Always accessible.</p>
                </div>

                <div class="template-selector">
                    <div class="template-btn ${state.selectedTemplate === 'ramadan' ? 'active' : ''}" onclick="window.KhatamTool.selectTemplate('ramadan')">
                        <h3 style="color:#fff;">ğŸŒ™ Ramadan 30 Hari</h3>
                        <p style="color:#fff;">1 juzuk/hari<br>Special untuk Ramadan</p>
                    </div>
                    <div class="template-btn ${state.selectedTemplate === 'yearround' ? 'active' : ''}" onclick="window.KhatamTool.selectTemplate('yearround')">
                        <h3>ğŸ“… Year-Round</h3>
                        <p>1 juzuk/hari<br>Consistent habit building</p>
                    </div>
                    <div class="template-btn ${state.selectedTemplate === 'custom' ? 'active' : ''}" onclick="window.KhatamTool.selectTemplate('custom')">
                        <h3>âš™ï¸ Custom Schedule</h3>
                        <p>Set your own pace<br>${state.customDays} hari target</p>
                    </div>
                </div>

                <div class="stats-dashboard">
                    <div class="stat-card">
                        <div class="stat-value">${completed}/30</div>
                        <div class="stat-label">Juzuk Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${percentage}%</div>
                        <div class="stat-label">Overall Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">ğŸ”¥ ${state.streak}</div>
                        <div class="stat-label">Days Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${remaining}</div>
                        <div class="stat-label">Juzuk Remaining</div>
                    </div>
                </div>

                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%">
                            ${percentage}% Complete
                        </div>
                    </div>
                </div>

                <div class="juzuk-grid">
                    ${juzukData.map(j => {
                        const isCompleted = state.completedJuzuk.includes(j.id);
                        const showDetails = state.showInfo[j.id];
                        return `
                            <div class="juzuk-card ${isCompleted ? 'completed' : ''}" onclick="window.KhatamTool.toggleJuzuk(${j.id})">
                                <div class="juzuk-header">
                                    <div class="checkbox ${isCompleted ? 'checked' : ''}">
                                        ${isCompleted ? 'âœ“' : ''}
                                    </div>
                                    <h3 class="juzuk-title">Juzuk ${j.juzuk}</h3>
                                </div>
                                <div class="juzuk-info">
                                    ğŸ“– ${j.startSurah} â†’ ${j.endSurah}<br>
                                    ğŸ“„ Muka Surat: ${j.pages}
                                </div>
                                <span class="info-toggle" onclick="event.stopPropagation(); window.KhatamTool.toggleInfo(${j.id})">
                                    ${showDetails ? 'â–² Tutup Details' : 'â–¼ Show Details'}
                                </span>
                                ${showDetails ? `
                                    <div class="info-details">
                                        <strong>Surah Permulaan:</strong> ${j.startSurah} (Ayat ${j.startAyat})<br>
                                        <strong>Surah Akhir:</strong> ${j.endSurah} (Ayat ${j.endAyat})<br>
                                        <strong>Anggaran Masa:</strong> 30-40 minit<br>
                                        <strong>Tips:</strong> Baca dengan tartil dan tadabbur. Quality > Speed.
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }).join('')}
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="window.KhatamTool.shareProgress()">
                        ğŸ“¤ Share Progress
                    </button>
                    <button class="btn btn-secondary" onclick="window.KhatamTool.toggleDarkMode()">
                        ${state.darkMode ? 'â˜€ï¸' : 'ğŸŒ™'} ${state.darkMode ? 'Light' : 'Dark'} Mode
                    </button>
                    <button class="btn btn-danger" onclick="window.KhatamTool.resetProgress()">
                        ğŸ”„ Reset Progress
                    </button>
                </div>

                <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e0e0e0; color: #666; font-size: 0.9rem;">
                    <p style="margin: 0;">Â© 2025 IlmuAlam.com | All Rights Reserved</p>
                    <p style="margin: 0.5rem 0 0 0;">Built with â¤ï¸ for the Muslim Ummah</p>
                </div>
            </div>
        `;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PUBLIC API
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    window.KhatamTool = {
        toggleJuzuk,
        selectTemplate,
        toggleInfo,
        shareProgress,
        resetProgress,
        toggleDarkMode
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function init() {
        loadState();
        render();
    }

    // Wait for DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

})();
